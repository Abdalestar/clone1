<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OneStamps Business Dashboard</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="screen">
        <div class="container">
            <div class="card">
                <h1>ðŸŽ« OneStamps Business</h1>
                <p class="subtitle">Generate one-time stamps for your customers</p>

                <form id="loginForm">
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="loginEmail" required placeholder="business@example.com">
                    </div>

                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="loginPassword" required placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                    </div>

                    <button type="submit" class="btn btn-primary">Login</button>
                </form>

                <div class="divider">OR</div>

                <button id="showSignupBtn" class="btn btn-secondary">Create Business Account</button>

                <div id="errorMessage" class="error-message"></div>
            </div>
        </div>
    </div>

    <!-- Signup Screen -->
    <div id="signupScreen" class="screen hidden">
        <div class="container">
            <div class="card">
                <h1>Create Business Account</h1>

                <form id="signupForm">
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="signupEmail" required placeholder="business@example.com">
                    </div>

                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="signupPassword" required placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" minlength="6">
                    </div>

                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" id="signupName" required placeholder="John Doe">
                    </div>

                    <div class="form-group">
                        <label>Phone Number</label>
                        <input type="tel" id="signupPhone" required placeholder="+974 XXXX XXXX">
                    </div>

                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" id="signupUsername" required placeholder="businessowner123">
                    </div>

                    <button type="submit" class="btn btn-primary">Create Account</button>
                    <button type="button" id="backToLoginBtn" class="btn btn-secondary">Back to Login</button>
                </form>

                <div id="signupError" class="error-message"></div>
            </div>
        </div>
    </div>

    <!-- Dashboard Screen -->
    <div id="dashboardScreen" class="screen hidden">
        <nav class="navbar">
            <div class="navbar-content">
                <h2>OneStamps Dashboard</h2>
                <div class="user-info">
                    <span id="userEmail"></span>
                    <button id="logoutBtn" class="btn btn-small">Logout</button>
                </div>
            </div>
        </nav>

        <div class="container">
            <!-- Business Selection -->
            <div class="card">
                <h3>Select Your Business</h3>
                <div id="businessSelector">
                    <select id="businessSelect" class="form-control">
                        <option value="">Loading businesses...</option>
                    </select>
                    <button id="createBusinessBtn" class="btn btn-secondary">+ Create New Business</button>
                </div>
            </div>

            <!-- Create Business Form (Hidden by default) -->
            <div id="createBusinessForm" class="card hidden">
                <h3>Create New Business</h3>
                <form id="newBusinessForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Business Name</label>
                            <input type="text" id="bizName" required placeholder="My Coffee Shop">
                        </div>
                        <div class="form-group">
                            <label>Category</label>
                            <select id="bizCategory" required>
                                <option value="coffee">Coffee Shop</option>
                                <option value="restaurant">Restaurant</option>
                                <option value="gym">Gym</option>
                                <option value="spa">Spa</option>
                                <option value="salon">Salon</option>
                                <option value="retail">Retail</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="bizDescription" rows="2" placeholder="Best coffee in town!"></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Address</label>
                            <input type="text" id="bizAddress" required placeholder="123 Main St, Doha">
                        </div>
                        <div class="form-group">
                            <label>Stamps Required</label>
                            <input type="number" id="bizStamps" required value="10" min="5" max="20">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Reward Description</label>
                        <input type="text" id="bizReward" required placeholder="Free Coffee">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Latitude</label>
                            <input type="number" id="bizLat" required step="0.0001" value="25.2867">
                        </div>
                        <div class="form-group">
                            <label>Longitude</label>
                            <input type="number" id="bizLng" required step="0.0001" value="51.5333">
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary">Create Business</button>
                    <button type="button" id="cancelBusinessBtn" class="btn btn-secondary">Cancel</button>
                </form>
            </div>

            <!-- Stamp Generator -->
            <div id="stampGenerator" class="card hidden">
                <h3>Generate One-Time Stamps</h3>

                <div class="stats-row">
                    <div class="stat-card">
                        <div class="stat-value" id="activeStamps">0</div>
                        <div class="stat-label">Active Stamps</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="usedStamps">0</div>
                        <div class="stat-label">Used Stamps</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="expiredStamps">0</div>
                        <div class="stat-label">Expired Stamps</div>
                    </div>
                </div>

                <form id="generateForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Number of Stamps</label>
                            <input type="number" id="quantity" required min="1" max="500" value="10">
                            <small>Max 500 stamps per batch</small>
                        </div>

                        <div class="form-group">
                            <label>Expires In (Days)</label>
                            <select id="expiryDays" required>
                                <option value="1">1 Day</option>
                                <option value="7" selected>1 Week</option>
                                <option value="14">2 Weeks</option>
                                <option value="30">1 Month</option>
                                <option value="90">3 Months</option>
                            </select>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary btn-large">
                        ðŸŽ« Generate Stamps
                    </button>
                </form>

                <div id="generationStatus" class="status-message"></div>
            </div>

            <!-- Stamps Display -->
            <div id="stampsDisplay" class="card hidden">
                <div class="card-header">
                    <h3>Generated Stamps</h3>
                    <button id="downloadAllBtn" class="btn btn-primary">Download All QR Codes</button>
                </div>

                <div id="stampsList" class="stamps-grid"></div>
            </div>

            <!-- All Stamps Table -->
            <div id="allStampsTable" class="card hidden">
                <h3>All Your Stamps</h3>
                <div class="table-controls">
                    <button id="refreshStampsBtn" class="btn btn-secondary">Refresh</button>
                    <select id="filterStatus" class="form-control">
                        <option value="">All Statuses</option>
                        <option value="active">Active</option>
                        <option value="used">Used</option>
                        <option value="expired">Expired</option>
                    </select>
                </div>
                <div class="table-container">
                    <table id="stampsTable">
                        <thead>
                            <tr>
                                <th>Stamp Code</th>
                                <th>Status</th>
                                <th>Created</th>
                                <th>Expires</th>
                                <th>Used By</th>
                                <th>Used At</th>
                            </tr>
                        </thead>
                        <tbody id="stampsTableBody">
                            <tr><td colspan="6">Select a business to view stamps</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Include QR Code Library -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>

    <!-- Include Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Main App Script -->
    <script src="app.js"></script>
</body>
</html>
